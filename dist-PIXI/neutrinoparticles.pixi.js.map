{"version":3,"sources":["../src/PIXI/PIXINeutrinoContext.js","../src/PIXI/PIXINeutrinoEffect.js","../src/PIXI/PIXINeutrinoEffectModel.js","../src/PIXI/PIXINeutrinoMaterials.js","../src/PIXI/PIXINeutrinoRenderBuffers.js"],"names":["PIXINeutrinoContext","renderer","gl","neutrino","NeutrinoParticles","effectsBasePath","texturesBasePath","trimmedExtensionLookupFirst","PIXI","CanvasRenderer","materials","PIXINeutrinoMaterials","path","success","fail","initializeNoise","loadEffect","PIXINeutrinoEffect","effectModel","position","rotation","scale","ctx","effect","set","positionZ","x","y","scaleZ","ready","_onEffectReady","once","_updateWorldTransform","dt","update","_scaledPosition","axisangle2quat_","worldRotationDegree","baseParent","sx","worldScale","sy","m","worldTransform","context","setTransform","a","b","c","d","tx","ty","draw","setObjectRenderer","emptyRenderer","setup","fillGeometryBuffers","renderBuffers","updateGlBuffers","bind","renderCallIdx","numRenderCalls","renderCall","renderCalls","texIndex","model","renderStyles","renderStyleIndex","textureIndices","bindTexture","textures","materialIndex","switchToNormal","switchToAdd","switchToMultiply","numIndices","startIndex","restart","resetPosition","name","value","setPropertyInAllEmitters","getNumParticles","worldPosition","localPosition","Point","localXAxis","localYAxis","worldXAxis","worldYAxis","toLocal","toGlobal","Math","sqrt","_calcWorldRotation","PI","obj","parent","createCanvas2DInstance","textureDescs","textureImageDescs","PIXINeutrinoRenderBuffers","createWGLInstance","texturesRemap","emit","Container","PIXINeutrinoEffectModel","effectPath","numTexturesToLoadLeft","pixiNeutrinoEffect","_onEffectLoaded","numTextures","length","imageIndex","texturePath","texture","trimmedTexturePath","replace","utils","TextureCache","Texture","fromImage","baseTexture","hasLoaded","_onTextureLoaded","self","index","image","source","ImageDesc","orig","width","height","_initTexturesRemapIfNeeded","remapNeeded","texIdx","realWidth","realHeight","SubRect","DisplayObject","vertexShaderSource","fragmentShaderSource","fragmentShaderMultiplySource","shader","Shader","shaderMultiply","currentShader","attributes","aVertexPosition","aColor","aTextureCoord","worldMatrixArray","worldMatrix","_setShader","state","setBlendMode","bindShader","uniforms","uSampler","geometryBuffers","positions","colors","texCoords","maxNumVertices","numVertices","indices","maxNumRenderCalls","texChannels","Float32Array","ArrayBuffer","Uint8Array","texChannel","numComponents","Uint16Array","bindVao","positionBuffer","glCore","GLBuffer","createVertexBuffer","DYNAMIC_DRAW","colorBuffer","texBuffers","buffer","push","indicesBuffer","createIndexBuffer","STATIC_DRAW","vao","createVao","addIndex","addAttribute","positionAttrib","FLOAT","colorAttrib","UNSIGNED_BYTE","texAttrib","vertex","color","rc","Object","assign","upload","DataView","forEach","size","start","TRIANGLES","destroy"],"mappings":"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","file":"neutrinoparticles.pixi.js","sourcesContent":["class PIXINeutrinoContext {\r\n\r\n\tconstructor(renderer) {\r\n\t\tvar gl = renderer.gl;\r\n\t\t\r\n\t\tthis.renderer = renderer;\r\n\t\tthis.neutrino = new NeutrinoParticles();\r\n\t\tthis.effectsBasePath = \"\";\r\n\t\tthis.texturesBasePath = \"\";\r\n\t\tthis.trimmedExtensionLookupFirst = true;\r\n\r\n\t\tif (!(renderer instanceof PIXI.CanvasRenderer)) {\r\n\t\t\tthis.materials = new PIXINeutrinoMaterials(this);\r\n\t\t}\r\n\t}\r\n\r\n\tinitializeNoise(path, success, fail) {\r\n\t\tthis.neutrino.initializeNoise(path, success, fail);\r\n\t}\r\n\r\n\tloadEffect(path, success, fail) {\r\n\t\tthis.neutrino.loadEffect(path, success, fail);\r\n\t}\r\n}\r\n","class PIXINeutrinoEffect extends PIXI.Container {\r\n\r\n\tconstructor(effectModel, position, rotation, scale) {\r\n\t\tsuper();\r\n\r\n\t\tthis.ctx = effectModel.ctx;\r\n\t\tthis.effectModel = effectModel;\r\n\t\tthis.effect = null;\r\n\t\tif (position)\r\n\t\t{\r\n\t\t\tthis.position.set(position[0], position[1]);\r\n\t\t\tthis.positionZ = position[2];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.position.set(0, 0);\r\n\t\t\tthis.positionZ = 0;\r\n\t\t}\r\n\r\n\t\tif (rotation)\r\n\t\t\tthis.rotation = rotation;\r\n\r\n\t\tif (scale) {\r\n\t\t\tthis.scale.x = scale[0];\r\n\t\t\tthis.scale.y = scale[1];\r\n\t\t\tthis.scaleZ = scale[2];\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.scaleZ = 1;\r\n\r\n\t\tif (effectModel.ready()) {\r\n\t\t\tthis._onEffectReady();\r\n\t\t} else {\r\n\t\t\teffectModel.once('ready', function () {\r\n\t\t\t\tthis._onEffectReady();\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tthis._updateWorldTransform();\r\n\t}\r\n\r\n\tready() {\r\n\t\treturn this.effect != null;\r\n\t}\r\n\r\n\tupdate(dt) {\r\n\t\tthis._updateWorldTransform();\r\n\t\t\r\n\t\tif (this.effect != null) {\r\n\t\t\tthis.effect.update(dt, this._scaledPosition(),\r\n\t\t\t\tthis.ctx.neutrino.axisangle2quat_([0, 0, 1], this.worldRotationDegree));\r\n\t\t}\r\n\t}\r\n\r\n\trenderCanvas(renderer) {\r\n\t\tif (!this.ready())\r\n\t\t\treturn;\r\n\r\n\t\tif (this.baseParent)\r\n\t\t{\r\n\t\t\tvar sx = this.worldScale.x;\r\n\t\t\tvar sy = this.worldScale.y;\r\n\t\t\tvar m = this.baseParent.worldTransform;\r\n\t\t\trenderer.context.setTransform(m.a * sx, m.b * sy, m.c * sx, m.d * sy, m.tx * sx, \r\n\t\t\t\tm.ty * sy);\r\n\t\t} else {\r\n\t\t\trenderer.context.setTransform(this.worldScale.x, 0, 0, this.worldScale.y, 0, 0);\r\n\t\t}\r\n\t\t\r\n\t\tthis.effect.draw(renderer.context);\r\n\t};\r\n\r\n\trenderWebGL(renderer) {\r\n\t\tif (!this.ready())\r\n\t\t\treturn;\r\n\r\n\t\trenderer.setObjectRenderer(renderer.emptyRenderer);\r\n\r\n\t\tif (this.baseParent)\r\n\t\t{\r\n\t\t\tvar sx = this.worldScale.x;\r\n\t\t\tvar sy = this.worldScale.y;\r\n\t\t\tvar m = this.baseParent.worldTransform;\r\n\t\t\tthis.ctx.materials.setup([m.a * sx, m.b * sy, 0, m.c * sx, m.d * sy, 0,\r\n\t\t\t\tm.tx * sx, m.ty * sy, 1]);\r\n\t\t} else {\r\n\t\t\tthis.ctx.materials.setup([this.worldScale.x, 0, 0, 0, this.worldScale.y, 0, 0, 0, 1]);\r\n\t\t}\r\n\r\n\t\tthis.effect.fillGeometryBuffers([1, 0, 0], [0, -1, 0], [0, 0, -1]);\r\n\r\n\t\tthis.renderBuffers.updateGlBuffers();\r\n\t\tthis.renderBuffers.bind();\r\n\r\n\t\tfor (var renderCallIdx = 0; renderCallIdx < this.renderBuffers.numRenderCalls; ++renderCallIdx) {\r\n\t\t\tvar renderCall = this.renderBuffers.renderCalls[renderCallIdx];\r\n\t\t\tvar texIndex = this.effect.model.renderStyles[renderCall.renderStyleIndex].textureIndices[0];\r\n\r\n\t\t\trenderer.bindTexture(this.effectModel.textures[texIndex], 0, true);\r\n\r\n\t\t\tvar materialIndex = this.effect.model.renderStyles[renderCall.renderStyleIndex].materialIndex;\r\n\t\t\tswitch (this.effect.model.materials[materialIndex]) {\r\n\t\t\t\tdefault: this.ctx.materials.switchToNormal(); break;\r\n\t\t\t\tcase 1: this.ctx.materials.switchToAdd(); break;\r\n\t\t\t\tcase 2: this.ctx.materials.switchToMultiply(); break;\r\n\t\t\t}\r\n\r\n\t\t\tthis.renderBuffers.draw(renderCall.numIndices, renderCall.startIndex);\r\n\t\t}\r\n\t}\r\n\r\n\trestart(position, rotation) {\r\n\t\tif (position) {\r\n\t\t\tthis.position.x = position[0];\r\n\t\t\tthis.position.y = position[1];\r\n\t\t\tthis.positionZ = position[2];\r\n\t\t}\r\n\r\n\t\tif (rotation) {\r\n\t\t\tthis.rotation = rotation;\r\n\t\t}\r\n\r\n\t\tthis._updateWorldTransform();\r\n\r\n\t\tthis.effect.restart(this._scaledPosition(),\r\n\t\t\trotation ? this.ctx.neutrino.axisangle2quat_([0, 0, 1], this.worldRotationDegree) \r\n\t\t\t: null);\r\n\t}\r\n\r\n\tresetPosition(position, rotation) {\r\n\t\tif (position) {\r\n\t\t\tthis.position.x = position[0];\r\n\t\t\tthis.position.y = position[1];\r\n\t\t\tthis.positionZ = position[2];\r\n\t\t}\r\n\r\n\t\tif (rotation) {\r\n\t\t\tthis.rotation = rotation;\r\n\t\t}\r\n\r\n\t\tthis._updateWorldTransform();\r\n\r\n\t\tthis.effect.resetPosition(this._scaledPosition(),\r\n\t\t\trotation ? this.ctx.neutrino.axisangle2quat_([0, 0, 1], this.worldRotationDegree) : null);\r\n\t}\r\n\r\n\tsetPropertyInAllEmitters(name, value) {\r\n\t\tthis.effect.setPropertyInAllEmitters(name, value);\r\n\t}\r\n\r\n\tgetNumParticles() {\r\n\t\treturn this.effect.getNumParticles();\r\n\t}\r\n\r\n\t_scaledPosition() {\r\n\t\treturn [this.worldPosition.x / this.worldScale.x, this.worldPosition.y / \r\n\t\t\tthis.worldScale.y, this.positionZ / this.scaleZ];\r\n\t}\r\n\r\n\t_updateWorldTransform() {\r\n\t\tvar localPosition = new PIXI.Point(0, 0);\r\n\t\tvar localXAxis = new PIXI.Point(1, 0);\r\n\t\tvar localYAxis = new PIXI.Point(0, 1);\r\n\r\n\t\tvar worldXAxis, worldYAxis;\r\n\r\n\t\tif (this.baseParent)\r\n\t\t{\r\n\t\t\tthis.worldPosition = this.baseParent.toLocal(localPosition, this);\r\n\t\t\tworldXAxis = this.baseParent.toLocal(localXAxis, this);\r\n\t\t\tworldYAxis = this.baseParent.toLocal(localYAxis, this);\r\n\t\t} else {\r\n\t\t\tthis.worldPosition = this.toGlobal(localPosition);\r\n\t\t\tworldXAxis = this.toGlobal(localXAxis);\r\n\t\t\tworldYAxis = this.toGlobal(localYAxis);\r\n\t\t}\r\n\r\n\t\tworldXAxis.x -= this.worldPosition.x;\r\n\t\tworldXAxis.y -= this.worldPosition.y;\r\n\t\tworldYAxis.x -= this.worldPosition.x;\r\n\t\tworldYAxis.y -= this.worldPosition.y;\r\n\r\n\t\tthis.worldScale = {\r\n\t\t\tx: Math.sqrt(worldXAxis.x * worldXAxis.x + worldXAxis.y * worldXAxis.y),\r\n\t\t\ty: Math.sqrt(worldYAxis.x * worldYAxis.x + worldYAxis.y * worldYAxis.y),\r\n\t\t};\r\n\r\n\t\tthis.worldRotationDegree = (this._calcWorldRotation(this) / Math.PI * 180) % 360;\r\n\t}\r\n\r\n\t_calcWorldRotation(obj) {\r\n\t\tif (obj.parent && obj.parent != this.baseParent)\r\n\t\t\treturn obj.rotation + this._calcWorldRotation(obj.parent);\r\n\t\telse\r\n\t\t\treturn obj.rotation;\r\n\t}\r\n\r\n\t_onEffectReady() {\r\n\t\tthis._updateWorldTransform();\r\n\r\n\t\tvar position = this._scaledPosition();\r\n\t\tvar rotation = this.ctx.neutrino.axisangle2quat_([0, 0, 1], this.worldRotationDegree);\r\n\r\n\t\tif (this.effectModel.ctx.renderer instanceof PIXI.CanvasRenderer) {\r\n\t\t\tthis.effect = this.effectModel.effectModel.createCanvas2DInstance(position, rotation);\r\n\t\t\tthis.effect.textureDescs = this.effectModel.textureImageDescs;\r\n\t\t} else {\r\n\t\t\tthis.renderBuffers = new PIXINeutrinoRenderBuffers(this.ctx);\r\n\t\t\tthis.effect = this.effectModel.effectModel.createWGLInstance(position, rotation, this.renderBuffers);\r\n\t\t\tthis.effect.texturesRemap = this.effectModel.texturesRemap;\r\n\t\t}\r\n\r\n\t\tthis.emit('ready', this);\r\n\t}\r\n}\r\n","class PIXINeutrinoEffectModel extends PIXI.DisplayObject {\r\n\r\n\tconstructor(context, effectPath) {\r\n\t\tsuper();\r\n\r\n\t\tthis.ctx = context;\r\n\t\tthis.effectPath = effectPath;\r\n\t\tthis.effectModel = null;\r\n\t\tthis.numTexturesToLoadLeft = -1;\r\n\t\tthis.texturesRemap = null;\r\n\r\n\t\tvar pixiNeutrinoEffect = this;\r\n\t\tthis.ctx.neutrino.loadEffect(this.ctx.effectsBasePath + effectPath, function (effectModel) {\r\n\t\t\tpixiNeutrinoEffect._onEffectLoaded(effectModel);\r\n\t\t});\r\n\t}\r\n\r\n\tready() {\r\n\t\treturn this.numTexturesToLoadLeft === 0;\r\n\t}\r\n\r\n\t_onEffectLoaded(effectModel) {\r\n\t\tthis.effectModel = effectModel;\r\n\t\tthis.textures = [];\r\n\t\tthis.textureImageDescs = [];\r\n\t\tvar numTextures = effectModel.textures.length;\r\n\t\tthis.numTexturesToLoadLeft = numTextures;\r\n\r\n\t\tfor (var imageIndex = 0; imageIndex < numTextures; ++imageIndex) {\r\n\t\t\tvar texturePath = effectModel.textures[imageIndex];\r\n\t\t\tvar texture = null;\r\n\t\t\t\r\n\t\t\tif (this.ctx.trimmedExtensionLookupFirst) {\r\n\t\t\t\tvar trimmedTexturePath = texturePath.replace(/\\.[^/.]+$/, \"\"); // https://stackoverflow.com/a/4250408\r\n\t\t\t\ttexture = PIXI.utils.TextureCache[trimmedTexturePath];\r\n\t\t\t}\r\n\r\n\t\t\tif (!texture)\r\n\t\t\t\ttexture = PIXI.utils.TextureCache[texturePath];\r\n\r\n\t\t\tif (!texture)\r\n\t\t\t\ttexture = PIXI.Texture.fromImage(this.ctx.texturesBasePath + texturePath);\r\n\r\n\t\t\tif (texture.baseTexture.hasLoaded) {\r\n\t\t\t\tthis._onTextureLoaded(imageIndex, texture);\r\n\t\t\t} else {\r\n\t\t\t\ttexture.once('update', function (self, imageIndex, texture) {\r\n\t\t\t\t\treturn function () {\r\n\t\t\t\t\t\tself._onTextureLoaded(imageIndex, texture);\r\n\t\t\t\t\t}\r\n\t\t\t\t} (this, imageIndex, texture));\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t_onTextureLoaded(index, texture) {\r\n\t\tthis.textures[index] = texture;\r\n\r\n\t\tthis.numTexturesToLoadLeft--;\r\n\r\n\t\tif (this.ctx.renderer instanceof PIXI.CanvasRenderer) {\r\n\t\t\tvar image = texture.baseTexture.source;\r\n\t\t\tthis.textureImageDescs[index] = new this.ctx.neutrino.ImageDesc(image, texture.orig.x, texture.orig.y,\r\n\t\t\t\ttexture.orig.width, texture.orig.height);\r\n\t\t} else {\r\n\t\t}\r\n\r\n\t\tif (this.numTexturesToLoadLeft === 0) {\r\n\r\n\t\t\tif (this.ctx.renderer instanceof PIXI.CanvasRenderer) {\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis._initTexturesRemapIfNeeded();\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit('ready', this);\r\n\t\t}\r\n\t}\r\n\r\n\t_initTexturesRemapIfNeeded() {\r\n\t\tvar remapNeeded = false;\r\n\r\n\t\tfor (var texIdx = 0; texIdx < this.textures.length; ++texIdx) {\r\n\t\t\tvar texture = this.textures[texIdx];\r\n\r\n\t\t\tif (texture.orig.x != 0 || texture.orig.y != 0\r\n\t\t\t\t|| texture.orig.width != texture.baseTexture.realWidth\r\n\t\t\t\t|| texture.orig.height != texture.baseTexture.realHeight) {\r\n\t\t\t\tremapNeeded = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.texturesRemap = [];\r\n\t\tif (remapNeeded) {\r\n\t\t\tfor (var texIdx = 0; texIdx < this.textures.length; ++texIdx) {\r\n\t\t\t\tvar texture = this.textures[texIdx];\r\n\r\n\t\t\t\tthis.texturesRemap[texIdx] = new this.ctx.neutrino.SubRect(\r\n\t\t\t\t\ttexture.orig.x / texture.baseTexture.realWidth,\r\n\t\t\t\t\t1.0 - (texture.orig.y + texture.orig.height) / texture.baseTexture.realHeight,\r\n\t\t\t\t\ttexture.orig.width / texture.baseTexture.realWidth,\r\n\t\t\t\t\ttexture.orig.height / texture.baseTexture.realHeight\r\n\t\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","class PIXINeutrinoMaterials {\r\n\r\n\tconstructor(ctx) {\r\n        this.ctx = ctx;\r\n\t\tthis.renderer = ctx.renderer;\r\n\t\tvar gl = this.renderer.gl;\r\n\r\n\t\tvar vertexShaderSource = \"\\\r\n/* NeutrinoParticles Vertex Shader */ \\n\\\r\nattribute vec3 aVertexPosition;\\n\\\r\nattribute vec4 aColor; \\n\\\r\nattribute vec2 aTextureCoord;\\n\\\r\n\\n\\\r\nuniform mat3 projectionMatrix;\\n\\\r\nuniform mat3 worldMatrix;\\n\\\r\n\\n\\\r\nvarying vec4 vColor;\\n\\\r\nvarying vec2 vTextureCoord;\\n\\\r\n\\n\\\r\nvoid main(void) {\\n\\\r\n\tgl_Position = vec4((projectionMatrix * worldMatrix * vec3(aVertexPosition.xy, 1)).xy, 0, 1);\\n\\\r\n\tvColor = vec4(aColor.rgb * aColor.a, aColor.a);\\n\\\r\n\tvTextureCoord = vec2(aTextureCoord.x, 1.0 - aTextureCoord.y);\\n\\\r\n}\";\r\n\r\n\t\tvar fragmentShaderSource = \"\\\r\n/* NeutrinoParticles Fragment Shader (Normal, Add materials) */ \\n\\\r\nprecision mediump float;\\n\\\r\n\\n\\\r\nvarying vec4 vColor;\\n\\\r\nvarying vec2 vTextureCoord;\\n\\\r\n\\n\\\r\nuniform sampler2D uSampler;\\n\\\r\n\\n\\\r\nvoid main(void) {\\n\\\r\n\tgl_FragColor = vColor * texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\\n\\\r\n}\";\r\n\r\n\t\tvar fragmentShaderMultiplySource = \"\\\r\n/* NeutrinoParticles Fragment Shader (Multiply material) */ \\n\\\r\nprecision mediump float;\\n\\\r\n\\n\\\r\nvarying vec4 vColor;\\n\\\r\nvarying vec2 vTextureCoord;\\n\\\r\n\\n\\\r\nuniform sampler2D uSampler;\\n\\\r\n\\n\\\r\nvoid main(void)\\n\\\r\n{\\n\\\r\n\tvec4 texel = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\\n\\\r\n\tvec3 rgb = vColor.rgb * texel.rgb;\\n\\\r\n\tfloat alpha = vColor.a * texel.a;\\n\\\r\n\tgl_FragColor = vec4(mix(vec3(1, 1, 1), rgb, alpha), 1);\\n\\\r\n}\";\r\n\r\n\t\tthis.shader = new PIXI.Shader(gl, vertexShaderSource, fragmentShaderSource);\r\n\t\tthis.shaderMultiply = new PIXI.Shader(gl, vertexShaderSource, fragmentShaderSource);\r\n\t\tthis.currentShader = null;\r\n\t}\r\n\r\n\tshutdown() {\r\n\t}\r\n\r\n\tpositionAttrib() {\r\n\t\treturn this.shader.attributes.aVertexPosition;\r\n\t}\r\n\r\n\tcolorAttrib() {\r\n\t\treturn this.shader.attributes.aColor;\r\n\t}\r\n\r\n\ttexAttrib(index) {\r\n\t\treturn this.shader.attributes.aTextureCoord;\r\n\t}\r\n\r\n\tsetup(worldMatrixArray) {\r\n\t\tthis.worldMatrix = worldMatrixArray;\r\n\t\tthis.currentShader = null;\r\n\t}\r\n\r\n\tswitchToNormal() {\r\n\t\tthis._setShader(this.shader);\r\n\t\tthis.renderer.state.setBlendMode(0);\r\n\t}\r\n\r\n\tswitchToAdd() {\r\n\t\tthis._setShader(this.shader);\r\n\t\tthis.renderer.state.setBlendMode(1);\r\n\t}\r\n\r\n\tswitchToMultiply(renderer) {\r\n\t\tthis._setShader(this.shaderMultiply);\r\n\t\tthis.renderer.state.setBlendMode(2);\r\n\t}\r\n\r\n\t_setShader(shader) {\r\n\t\tif (this.currentShader != shader)\r\n\t\t{\r\n\t\t\tthis.renderer.bindShader(shader);\r\n\t\t\tshader.uniforms.uSampler = 0;\r\n\t\t\tshader.uniforms.worldMatrix = this.worldMatrix;\r\n\r\n\t\t\tthis.currentShader = shader;\r\n\t\t}\r\n\t}\r\n}\r\n","class PIXINeutrinoRenderBuffers {\r\n\tconstructor(context, geometryBuffers) {\r\n\t\tthis.ctx = context;\r\n\t\tthis.gl = this.ctx.renderer.gl;\r\n\r\n\t\tthis.positions = null;\r\n\t\tthis.colors = null;\r\n\t\tthis.texCoords = [];\r\n\t\tthis.maxNumVertices = 0;\r\n\t\tthis.numVertices = 0;\r\n\t\tthis.indices = null;\r\n\r\n\t\tthis.renderCalls = [];\r\n\t\tthis.maxNumRenderCalls = 0;\r\n\t\tthis.numRenderCalls = 0;\r\n\t}\r\n\r\n\tinitialize(maxNumVertices, texChannels, indices, maxNumRenderCalls) {\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tthis.positions = new Float32Array(new ArrayBuffer(4 * maxNumVertices * 3));\r\n\t\tthis.colors = new Uint8Array(new ArrayBuffer(4 * maxNumVertices));\r\n\t\tthis.texCoords = [];\r\n\t\tfor (var texChannel = 0; texChannel < texChannels.length; ++texChannel) {\r\n\t\t\tthis.texCoords[texChannel] = new Float32Array(new ArrayBuffer(4 * maxNumVertices * texChannels[texChannel]));\r\n\t\t\tthis.texCoords[texChannel].numComponents = texChannels[texChannel];\r\n\t\t}\r\n\t\tthis.maxNumVertices = maxNumVertices;\r\n\r\n\t\tthis.indices = new Uint16Array(new ArrayBuffer(2 * indices.length));\r\n\t\tthis.indices.set(indices, 0);\r\n\r\n\t\tthis.maxNumRenderCalls = maxNumRenderCalls;\r\n\r\n        // set null vao to prevent overriding of it's buffers to next ones\r\n\t\tthis.ctx.renderer.bindVao(null);\r\n\r\n\t\tthis.positionBuffer = PIXI.glCore.GLBuffer.createVertexBuffer(gl,\r\n\t\t\t this.positions, gl.DYNAMIC_DRAW);\r\n\r\n\t\tthis.colorBuffer = PIXI.glCore.GLBuffer.createVertexBuffer(gl,\r\n\t\t\tthis.colors, gl.DYNAMIC_DRAW);\r\n\r\n\t\tthis.texBuffers = [];\r\n\t\tfor (var texIndex = 0; texIndex < this.texCoords.length; ++texIndex) {\r\n\t\t\tvar buffer = PIXI.glCore.GLBuffer.createVertexBuffer(gl,\r\n\t\t\t\tthis.texCoords[texIndex], gl.DYNAMIC_DRAW);\r\n\t\t\tthis.texBuffers.push(buffer);\r\n\t\t}\r\n\r\n\t\tthis.indicesBuffer = PIXI.glCore.GLBuffer.createIndexBuffer(gl,\r\n\t\t\tthis.indices, gl.STATIC_DRAW);\r\n\r\n\t\tvar materials = this.ctx.materials;\r\n\r\n\t\tthis.vao = this.ctx.renderer.createVao().addIndex(this.indicesBuffer).\r\n\t\t\taddAttribute(this.positionBuffer, materials.positionAttrib(), gl.FLOAT, false, 0, 0).\r\n\t\t\taddAttribute(this.colorBuffer, materials.colorAttrib(), gl.UNSIGNED_BYTE, true, 0, 0);\r\n\r\n\t\t\tfor (var texIndex = 0; texIndex < this.texCoords.length; ++texIndex) {\r\n\t\t\t\tthis.vao.addAttribute(this.texBuffers[texIndex], materials.texAttrib(texIndex),\r\n\t\t\t\t\tgl.FLOAT, false, 0, 0);\r\n\t\t\t}\r\n\t}\r\n\r\n\tpushVertex(vertex) {\r\n\t\tthis.positions.set(vertex.position, this.numVertices * 3);\r\n\t\tthis.colors.set(vertex.color, this.numVertices * 4);\r\n\r\n\t\tfor (var texIndex = 0; texIndex < vertex.texCoords.length; ++texIndex) {\r\n\t\t\tthis.texCoords[texIndex].set(vertex.texCoords[texIndex],\r\n\t\t\t\tthis.numVertices * this.texCoords[texIndex].numComponents);\r\n\t\t}\r\n\r\n\t\t++this.numVertices;\r\n\t}\r\n\r\n\tpushRenderCall(rc) {\r\n\r\n\t\tif (this.numRenderCalls >= this.renderCalls.length)\r\n\t\t\tthis.renderCalls.push(Object.assign({}, rc));\r\n\t\telse\r\n\t\t\tObject.assign(this.renderCalls[this.numRenderCalls], rc);\r\n\r\n\t\t++this.numRenderCalls;\r\n\t}\r\n\r\n\tcleanup() {\r\n\t\tthis.numVertices = 0;\r\n\t\tthis.numRenderCalls = 0;\r\n\t}\r\n\r\n\tupdateGlBuffers() {\r\n\t\tvar gl = this.gl;\r\n\r\n\t\tif (this.numVertices > 0)\r\n\t\t{\r\n\t\t\tthis.positionBuffer.upload(new DataView(this.positions.buffer, 0, \r\n\t\t\t\t4 * this.numVertices * 3), 0);\r\n\t\t\tthis.colorBuffer.upload(new DataView(this.colors.buffer, 0, this.numVertices * 4), 0);\r\n\r\n\t\t\tthis.texBuffers.forEach(function (buffer, index) {\r\n\t\t\t\tbuffer.upload(new DataView(this.texCoords[index].buffer, 0, \r\n\t\t\t\t\t4 * this.numVertices * this.texCoords[index].numComponents), 0);\r\n\t\t\t}, this);\r\n\t\t}\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.ctx.renderer.bindVao(this.vao);\r\n\t}\r\n\r\n\tdraw(size, start) {\r\n\t\tvar gl = this.gl;\r\n\t\t\r\n\t\tthis.vao.draw(gl.TRIANGLES, size, start);\r\n\t}\r\n\r\n\tshutdown() {\r\n\t\tthis.positionBuffer.destroy();\r\n\t\tthis.colorBuffer.destroy();\r\n\r\n\t\tthis.texBuffers.forEach(function (buffer) {\r\n\t\t\tbuffer.destroy();\r\n\t\t}, this);\r\n\t}\r\n}\r\n"]}